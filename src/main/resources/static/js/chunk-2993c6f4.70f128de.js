(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2993c6f4"],{"0fea":function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return n})),a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l}));var s=a("b775"),r={user:"/user",role:"/role",service:"/service",permission:"/permission",permissionNoPager:"/permission/no-pager",orgTree:"/org/tree",getUserInfo:"/org/getUserInfo"};function i(e){return Object(s["b"])({url:r.role,method:"get",params:e})}function n(e){return Object(s["b"])({url:r.service,method:"get",params:e})}function o(e){return Object(s["b"])({url:r.permissionNoPager,method:"get",params:e})}function l(e){return Object(s["b"])({url:r.orgTree,method:"get",params:e})}},"165b":function(e,t,a){},"1b3e":function(e,t,a){"use strict";a.r(t);var s,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("a-breadcrumb",[a("a-breadcrumb-item",[a("router-link",{attrs:{to:{path:"/tm/ProjectCard"}}},[e._v("返回")])],1),a("a-breadcrumb-item",{staticStyle:{"font-size":"20px"}},[e._v(e._s(e.name))])],1)],1),a("div",[a("a-tabs",{on:{change:e.handleCallback}},[a("a-tab-pane",{key:"1",attrs:{tab:"迭代"}},[e.isShowIterate?a("Iterate",{key:e.activekey,ref:"ite"}):e._e()],1),a("a-tab-pane",{key:"2",attrs:{tab:"任务"}},[e.isShowTask?a("Task",{key:e.activekey}):e._e()],1),a("a-tab-pane",{key:"3",attrs:{tab:"看板",forceRender:""}},[e.isShowDisplay?a("display",{key:e.activekey}):e._e()],1),a("a-tab-pane",{key:"4",attrs:{tab:"成员管理"}},[e.isShowMember?a("ProjectMembers",{key:e.activekey}):e._e()],1)],1)],1)])},i=[],n=(a("7364"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-layout",[a("a-layout-sider",{style:{background:"#fff"}},[a("a-button",{attrs:{block:"",icon:"plus",type:"primary"},on:{click:function(t){return e.$refs.AddIterateForm.add(e.id)}}},[e._v("新建迭代")]),a("AddIterateForm",{ref:"AddIterateForm",on:{"submit-add":e.appendToList}}),e._l(e.data,(function(t,s){return a("div",{key:s,staticClass:"card"},[a("a-card",{staticStyle:{cursor:"pointer"},on:{click:function(a){return e.queryTask(t.interationId)}}},[a("div",[a("span",[e._v("\n                 "+e._s(t.interationName)+"\n          "),a("a-tag",{staticStyle:{float:"right"},attrs:{color:e.tagColor(t.interationPeriod)}},[e._v("\n            "+e._s(e.userState(t.interationPeriod))+"\n          ")])],1),a("div",[e._v("　")]),a("a-progress",{attrs:{percent:t.interationProgress}})],1)])],1)}))],2),a("a-layout",[a("a-layout-header",{style:{margin:"0px 16px",background:"#fff",padding:0}},[[a("div",[a("span",[e._v("\n          　　　 "+e._s(e.iterates.interationName)+" 　\n          "+e._s(e.iterates.startDate)+"~"+e._s(e.iterates.endDate)+"\n        ")]),a("span",{staticStyle:{float:"right"}},[e._v("\n          共计"+e._s(e.totalCount)+"个任务　\n        ")]),a("span",{staticStyle:{float:"right",cursor:"pointer"},on:{click:function(t){return e.$refs.screenTask.add(e.tasks)}}},[a("a-icon",{attrs:{type:"filter"}}),e._v("筛选　\n        ")],1)])]],2),a("a-layout-content",{style:{margin:"24px 16px",background:"#fff",minHeight:"350px"}},[a("TaskContent",{ref:"task",on:{func:e.getMsgFormSon}})],1)],1),a("ScreenTask",{ref:"screenTask",on:{childFn:e.parentFn}})],1)}),o=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-table",{attrs:{columns:e.columns,dataSource:e.data,pagination:e.pagination,bordered:"",loading:e.isLoading},scopedSlots:e._u([e._l(["name","description","priority","dealUserName","taskStateName","taskClassName","createDate","startDate","endDate"],(function(t){return{key:t,fn:function(s,r,i){return[a("div",{key:t},[r.editable&&"startDate"===t?a("a-date-picker",{attrs:{defaultValue:e.moment(s,"YYYY-MM-DD")},on:{change:e.changeStartTime}}):r.editable&&"endDate"===t?a("a-date-picker",{attrs:{defaultValue:e.moment(s,"YYYY-MM-DD")},on:{change:e.changeEndTime}}):r.editable&&"priority"===t?a("a-select",{staticStyle:{width:"60px"},attrs:{defaultValue:s},on:{change:function(t){return e.changeSelect(r.taskId,t)}}},e._l(e.priorityData,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v(e._s(t.name))])})),1):r.editable&&"dealUserName"!=t&&"taskStateName"!=t&&"taskClassName"!=t?a("a-input",{staticStyle:{margin:"-5px 0",width:"100px"},attrs:{value:s},on:{change:function(a){return e.handleChange(a.target.value,r.taskId,t)}}}):"priority"===t?a("a-select",{staticStyle:{width:"60px"},attrs:{defaultValue:s},on:{change:function(t){return e.changeSelect(r.taskId,t)}}},e._l(e.priorityData,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v(e._s(t.name))])})),1):"name"===t?[a("a-popconfirm",{attrs:{placement:"topLeft"}},[a("template",{slot:"title"},[e._v("\n              "+e._s(r.description)+"\n            ")]),e._v("\n            "+e._s(s)+"\n          ")],2)]:r.editable&&"dealUserName"===t?a("a-select",{staticStyle:{width:"86px"},attrs:{showSearch:"",placeholder:"选择一个处理人",optionFilterProp:"children",filterOption:e.filterOption,defaultValue:s},on:{focus:e.handleFocus,blur:e.handleBlur,change:e.choseMember}},e._l(e.memberUser,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v(e._s(t.name))])})),1):"dealUserName"!==t||r.editable||"undefined"!=typeof s&&null!=s&&""!=s?[e._v(e._s(s)+"\n        ")]:[e._v("\n          未分配\n        ")]],2)]}}})),{key:"operation",fn:function(t,s,r){return[a("div",[a("a-dropdown",[a("a",{staticClass:"btn"},[a("a-icon",{attrs:{type:"ellipsis"}})],1),a("a-menu",{attrs:{slot:"overlay"},on:{click:function(t){return e.click1(s,t)}},slot:"overlay"},[a("a-menu-item",{key:"1"},[e._v("修改")]),a("a-menu-item",{key:"2"},[e._v("保存")]),a("a-menu-item",{key:"3"},[e._v("添加")]),a("a-menu-item",{key:"4"},[e._v("删除")]),s.iterId?a("a-menu-item",{key:"5"},[e._v("选择归属迭代")]):e._e()],1)],1)],1)]}}],null,!0)}),a("a-modal",{attrs:{title:"再次确认",okText:"确认",cancelText:"取消"},on:{ok:e.delete1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("p",[e._v("确认要删除吗？")])]),a("a-modal",{attrs:{visible:e.addTaskVisiable,cancelText:"取消",okText:"确认"},on:{cancel:function(t){e.addTaskVisiable=!1},ok:e.handleConfirm}},[a("template",{slot:"title"},[0==e.createType?a("span",{staticClass:"common-head-font"},[e._v("添加子任务")]):1==e.createType?a("span",{staticClass:"common-head-font"},[e._v("迭代："+e._s(e.iterNameDisplay)+" ， 添加任务")]):e._e()]),a("a-card",{attrs:{"body-style":{padding:"24px 32px"},bordered:!1}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{attrs:{label:"任务主题",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:12},sm:{span:17}}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["taskName",{rules:[{required:!0,message:"请输入任务主题"}]}],expression:"[\n          'taskName',\n          {rules: [{ required: true, message: '请输入任务主题' }]}\n        ]"}],attrs:{name:"taskName",placeholder:"请输入任务主题"}})],1),a("a-form-item",{attrs:{label:"任务描述",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:12},sm:{span:17}}}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["taskDes",{rules:[{required:!0,message:"请输入任务描述"}]}],expression:"[\n          'taskDes',\n          {rules: [{ required: true, message: '请输入任务描述' }]}\n        ]"}],attrs:{rows:"4",placeholder:"请输入任务描述"}})],1),a("a-form-item",{attrs:{label:"任务类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-row",[a("a-col",{attrs:{span:22}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["interationType",{rules:[{required:!0,message:"请选择任务类型"}]}],expression:"['interationType', {rules:[{required: true, message: '请选择任务类型'}]}]"}],attrs:{placeholder:"请选择任务类型",readonly:"readonly"}})],1),a("a-col",{attrs:{span:2}},[a("a-icon",{staticStyle:{"font-size":"20px",color:"#18c4b0",cursor:"pointer","padding-left":"20px"},attrs:{type:"plus-circle"},on:{click:function(t){return e.$refs.type.add()}}})],1)],1)],1),a("a-form-item",{attrs:{label:"任务处理人",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:12},sm:{span:17}}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["select",{rules:[{required:!1,message:"请选择处理人"}]}],expression:"['select',{rules: [{ required: false, message: '请选择处理人' }]}]"}],ref:"resetSelect",staticStyle:{width:"200px"},attrs:{prop:"select",clearable:"",showSearch:"",placeholder:"选择一个处理人",optionFilterProp:"children",filterOption:e.filterOption},on:{focus:e.handleFocus,blur:e.handleBlur,change:e.choseMember}},e._l(e.memberUser,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),a("a-form-item",{attrs:{label:"任务优先级",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:12},sm:{span:17}}}},[a("a-select",{staticStyle:{"max-width":"200px",width:"100%"},attrs:{labelInValue:"",defaultValue:{key:2},name:"taskPriority"},on:{change:function(t){return e.changeSelect1(t)}}},e._l(e.priorityData,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),a("a-form-item",{attrs:{label:"起止日期",labelCol:{lg:{span:7},sm:{span:7}},wrapperCol:{lg:{span:12},sm:{span:17}}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["buildTime",{rules:[{required:!0,message:"请输入任务起止日期"}]}],expression:"[\n          'buildTime',\n          {rules: [{ required: true, message: '请输入任务起止日期' }]}\n        ]"}],staticStyle:{width:"100%"},attrs:{name:"buildTime"}})],1)],1)],1),a("interType",{ref:"type",on:{childFn:e.parentFn}})],2),a("a-modal",{attrs:{visible:e.choseIterVisiable,cancelText:"取消",okText:"确认"},on:{cancel:function(t){e.choseIterVisiable=!1},ok:e.commit}},[a("label",{staticStyle:{"margin-left":"10px"}},[e._v("选择迭代：")]),a("a-select",{staticStyle:{"max-width":"200px",width:"100%"},attrs:{placeholder:"请选择",defaultValue:e.firstIterName},on:{change:e.getValue1}},e._l(e.selectList,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1)},c=[],d=(a("2338"),a("f763"),a("fb37"),a("1228")),u=a("f010"),h=a("d9c4"),f=a("d552"),m=a("6bf2"),p=a.n(m),g=a("75c6"),b=(a("155a"),a("f8a2")),y=a("a7af"),v=a("24d2");function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){Object(u["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var w,j=g["a"],C=[{title:"任务主题",dataIndex:"name",key:"name",scopedSlots:{customRender:"name"},width:150},{title:"优先级",dataIndex:"priority",key:"priority",scopedSlots:{customRender:"priority"},width:100},{title:"处理人",dataIndex:"dealUserName",key:"dealUserName",scopedSlots:{customRender:"dealUserName"},width:100},{title:"任务状态",dataIndex:"taskStateName",key:"taskStateName",scopedSlots:{customRender:"taskStateName"},width:110},{title:"任务分类",dataIndex:"taskClassName",key:"taskClassName",scopedSlots:{customRender:"taskClassName"},width:130},{title:"开始时间",dataIndex:"startDate",key:"startDate",scopedSlots:{customRender:"startDate"},width:140},{title:"结束时间",dataIndex:"endDate",key:"endDate",scopedSlots:{customRender:"endDate"},width:140},{title:"操作",dataIndex:"operation",key:"operation",scopedSlots:{customRender:"operation"},width:80}],O=[],S={onChange:function(e,t){console.log("selectedRowKeys: ".concat(e),"selectedRows: ",t)},onSelect:function(e,t,a){console.log(e,t,a)},onSelectAll:function(e,t,a){console.log(e,t,a)}},D={components:{AModal:f["a"],interType:y["a"]},name:"TaskContent",props:{iteId:String},data:function(){var e=this;return this.cacheData=O.map((function(e){return I({},e)})),{classId:"",id:"",taskId:"",visible:!1,dataFormat:"YYYY-MM-DD",labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:13}},data:O,columns:C,rowSelection:S,target:"",resultData:"",addTaskVisiable:!1,form:this.$form.createForm(this),addTaskId:"",priorityData:j,createType:"",isClick:!1,selectList:[],isDisplay:!1,isChose:!1,selectDefaultValue:"",isNeed:!0,isShow:!1,changeStartTime1:"",changeEndTime1:"",pagination:{defaultPageSize:5,showTotal:function(e){return"共 ".concat(e," 条数据")},showSizeChanger:!0,pageSizeOptions:["5","10","15","20"],onShowSizeChange:function(t,a){return e.pageSize=a}},memberUser:[],choseMem:"",isLoading:!0,choseIterVisiable:!1,firstIterId:"",firstIterName:"",choseIterTaskId:"",iterNameDisplay:""}},mounted:function(){this.id=this.$route.query.id,this.getData()},methods:(s={isLoad:function(){this.isLoading=!1},Load:function(){this.isLoading=!0},screenTask:function(e){this.buildData(e),this.data=Object(d["a"])(e)},newTask:function(e){this.data=e},parentFn:function(e){this.type=e,this.form.setFieldsValue({interationType:e.title}),this.classId=e.key[0]},commit:function(){var e=this;console.log("任务编号:"+this.choseIterTaskId),console.log("新归属迭代编号:"+this.firstIterId);var t={taskId:this.choseIterTaskId,iterId:this.firstIterId};Object(h["h"])(t).then((function(t){e.choseIterVisiable=!1,e.getValue(e.selected)}))},choseMember:function(e){console.log(e),this.choseMem=e},handleChange:function(e){console.log("selected ".concat(e))},handleBlur:function(e){console.log("blur"),this.choseMem=e},handleFocus:function(){console.log("focus")},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},moment:p.a,changeStartTime:function(e){console.log(e),this.changeStartTime1=e},changeEndTime:function(e){console.log(e),this.changeEndTime1=e},descriptionVisible:function(){this.isShow=!0},createTask:function(){for(var e=this,t=0;t<this.selectList.length;t++)this.selectList[t].id===this.selected&&(this.iterNameDisplay=this.selectList[t].name);Object(v["h"])({projectId:this.id}).then((function(t){e.memberUser=[];for(var a=0;a<t.length;a++)e.memberUser.push({id:t[a].userId,name:t[a].userName});e.isChose?(e.createType="1",e.addTaskId=0,e.addTaskVisiable=!0):e.isDisplay=!0}))},changeSelect1:function(e){this.target={priority:e.key}},openNotificationWithIcon:function(e,t,a){this.$notification[e]({message:t,description:a})},changeSelect:function(e,t){var a=this;if(console.log("taskId"+e),console.log("元素"+t),this.isClick)this.target.priority=t;else{var s={taskPriority:t,id:e};Object(h["d"])(s).then((function(e){a.getData()})),this.openNotificationWithIcon("success","提示","优先级修改成功")}},click1:function(e,t){if(this.isClick=!0,console.log(t.key),"1"===t.key)this.edit1(e.taskId);else if("2"===t.key)this.save(e.taskId),this.isClick=!1;else if("3"===t.key)this.addTaskId=e.taskId,this.add1(e.taskId),this.isClick=!1;else if("4"===t.key)this.delete2(e.taskId),this.isClick=!1;else if("5"===t.key){this.choseIterTaskId=e.taskId,this.choseIterVisiable=!0,this.isClick=!1,this.firstIterId=e.iterId;for(var a=0;a<this.selectList.length;a++)this.selectList[a].id===this.firstIterId&&(this.firstIterName=this.selectList[a].name);console.log("初始迭代id:"+this.firstIterId)}},getCurrentData:function(){return(new Date).toLocaleDateString()},findPriorityId:function(e){for(var t=0;t<j.length;t++)if(e===j[t].name)return j[t].id},buildData:function(e){if(e)for(var t=0;t<e.length;t++){e[t].key=e[t].taskId,e[t].name=e[t].taskName,e[t].description=e[t].taskDesc;for(var a=e[t].taskPriority,s=0;s<j.length;s++)if(a===j[s].id){e[t].priority=j[s].name;break}e[t].createDate=this.getDate(e[t].createDate),e[t].endDate=this.getDate(e[t].endDate),e[t].startDate=this.getDate(e[t].startDate),delete e[t].taskName,delete e[t].taskDesc,delete e[t].taskPriority,e[t].children&&(0===e[t].children.length&&delete e[t].children,this.buildData(e[t].children))}},getDate:function(e){var t=new Date(e);return t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+t.getDate()},getData:function(){var e=this;if(this.isLoading=!0,this.isChose)this.getValue(this.selected);else{this.$store.state.userContext.userInfo.staffId;Object(b["b"])({projectId:this.id}).then((function(t){e.selectList=[];var a=t;if(0!==a.length)for(var s=0;s<a.length;s++){var r=a[s].interationId,i=a[s].interationName;e.selectList.push({id:r,name:i})}}))}},getValue1:function(e){this.firstIterId=e},getValue:function(e){var t=this;this.isChose=!0,this.isDisplay=!1,null===e?(this.data=[],this.isLoading=!1):(this.selected=e,console.log("您选择了",this.selected),Object(h["f"])({IterationId:this.selected}).then((function(a){console.log("根据迭代获取任务信息");var s=a.result;t.$emit("func",s),t.buildData(s);for(var r=0;r<s.length;r++)s[r].iterId=e,s[r].isParent=!0;t.data=Object(d["a"])(s),console.log("result this.data：",t.data),t.isLoading=!1})).catch((function(e){t.isLoading=!1,t.$message.error(e)})))},handleConfirm:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var s,r=a.buildTime[0],i=a.buildTime[1];s=a.taskPriority?a.taskPriority.key:e.target.priority,s||(s=j[1].id);var n={dealUser:e.choseMem,createDate:new Date,endDate:i,parentId:e.addTaskId,taskName:a.taskName,taskDesc:a.taskDes,taskPriority:s,startDate:r};"0"===e.createType?(n.interationId=e.selected,n.taskTrip=e.classId,Object(h["a"])(n).then((function(t){e.getData()}))):"1"===e.createType&&(n.taskTrip=e.classId,n.interationType=e.form.getFieldValue("interationType"),n.interationId=e.selected,Object(h["b"])(n).then((function(t){e.getData()})))}})),this.form.setFieldsValue({interationType:""}),this.classId="",this.addTaskVisiable=!1,this.choseMem="",this.clearForm()},clearForm:function(){this.form.setFieldsValue({taskName:""}),this.form.setFieldsValue({taskDes:""}),this.form.setFieldsValue({select:void 0}),this.form.setFieldsValue({buildTime:void 0})}},Object(u["a"])(s,"handleChange",(function(e,t,a){""!=this.target&&(this.target[a]=e,this.data=this.resultData,this.target.editable=!0)})),Object(u["a"])(s,"findItem",(function(e,t){var a=Object(d["a"])(t),s=a.filter((function(t){return e===t.taskId}))[0];if(s)return s.editable=!0,this.target=s,void(this.data=this.resultData);for(var r=0;r<a.length;r++)if(a[r].children){var i=Object(d["a"])(a[r].children);this.findItem(e,i)}})),Object(u["a"])(s,"add1",(function(e){var t=this;0===this.memberUser.length&&Object(v["h"])({projectId:this.id}).then((function(e){t.memberUser=[];for(var a=0;a<e.length;a++)t.memberUser.push({id:e[a].userId,name:e[a].userName})})),this.createType="0",this.addTaskId=e,this.addTaskVisiable=!0})),Object(u["a"])(s,"edit1",(function(e){var t=this;Object(v["h"])({projectId:this.id}).then((function(a){t.memberUser=[];for(var s=0;s<a.length;s++)t.memberUser.push({id:a[s].userId,name:a[s].userName});t.resultData=Object(d["a"])(t.data),t.findItem(e,t.data)}))})),Object(u["a"])(s,"filterSth",(function(e,t,a){for(var s=0;s<e.length;s++)if(e[s].taskId===t)return e=e.filter((function(e){return t!==e.taskId})),a?void(this.data=[e]):e;for(var r=0;r<e.length;r++){var i=e[r].children;if(i){var n=this.filterSth(i,t,!1);n&&0!==n.length?e[r].children=n:delete e[r].children}}a&&(this.data=e)})),Object(u["a"])(s,"delete2",(function(e){this.visible=!0,this.taskId=e})),Object(u["a"])(s,"delete1",(function(){var e=this;Object(h["c"])({taskId:this.taskId}).then((function(t){e.getData()})),this.openNotificationWithIcon("success","提示","删除成功"),this.visible=!1})),Object(u["a"])(s,"isChinese",(function(e){var t=/[^\u4e00-\u9fa5]/;return!t.test(e)})),Object(u["a"])(s,"save",(function(e){var t=this;if(this.target.editable=!0){if(""!=this.target){var a,s;this.isChinese(this.target.priority)&&(this.target.priority=this.findPriorityId(this.target.priority)),delete this.target.editable,a=""!=this.changeStartTime1?this.changeStartTime1:Date.parse(this.target.startDate),s=""!=this.changeEndTime1?this.changeEndTime1:Date.parse(this.target.endDate);var r={createDate:Date.parse(this.target.createDate),creater:this.target.taskCreater,endDate:s,startDate:a,taskState:this.target.taskState,taskDesc:this.target.description,taskName:this.target.name,taskPriority:this.target.priority,taskTrip:this.target.taskClass,id:this.target.taskId,dealUser:this.choseMem};Object(h["d"])(r).then((function(e){t.getData(),t.choseMem=""}))}this.openNotificationWithIcon("success","提示","保存成功")}})),Object(u["a"])(s,"cancel",(function(e){var t=Object(d["a"])(this.data),a=t.filter((function(t){return e===t.taskId}))[0];a&&(Object.assign(a,this.cacheData.filter((function(t){return e===t.taskId}))[0]),delete a.editable,this.data=t)})),s)},x=D,N=(a("8ab4"),a("4e82")),T=Object(N["a"])(x,l,c,!1,null,"bb978294",null),_=T.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{width:600,visible:e.visible,title:"新增迭代"},on:{ok:e.handleSubmit,cancel:function(t){e.visible=!1}}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"迭代名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["interationName",{rules:[{required:!0,message:"请输入迭代名称"}]}],expression:"['interationName', {rules:[{required: true, message: '请输入迭代名称'}]}]"}],ref:"myInput",attrs:{placeholder:"请输入迭代名称"},on:{blur:e.queryIterate}})],1),a("a-form-item",{attrs:{label:"迭代描述",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["interationDesc",{rules:[{required:!0,message:"请输入迭代描述"}]}],expression:"['interationDesc', {rules:[{required: true, message: '请输入迭代描述'}]}]"}],attrs:{placeholder:"介绍一下这个迭代"}})],1),a("a-form-item",{attrs:{label:"迭代周期",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["time",{rules:[{required:!0,message:"请设置迭代周期"}]}],expression:"['time', {rules:[{required: true, message: '请设置迭代周期'}]}]"}],attrs:{format:"YYYY-MM-DD",disabledDate:e.disabledDate}})],1)],1),a("interType",{ref:"type",on:{childFn:e.parentFn}})],1)},P=[],$={name:"AddIterateForm",components:{interType:y["a"]},data:function(){return{readonly:!0,id:0,labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:13}},type:[],visible:!1,form:this.$form.createForm(this)}},methods:{moment:p.a,parentFn:function(e){this.type=e,this.form.setFieldsValue({interationType:e.title})},disabledDate:function(e){return e&&e<p()().endOf("day")},add:function(e){this.visible=!0,this.id=e},edit:function(e){var t=this.form.setFieldsValue;this.visible=!0,this.$nextTick((function(){t({taskName:"test"})}))},handleSubmit:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var s={projectId:e.id,interationName:a.interationName,interationDesc:a.interationDesc,startDate:a.time[0],endDate:a.time[1]};console.log(s),Object(b["a"])(s).then((function(t){e.$message.success("迭代创建成功"),e.visible=!1,e.form.resetFields(),e.$emit("submit-add",a)})).catch((function(t){e.$message.error("迭代创建失败"),e.form.resetFields()}))}}))},queryIterate:function(){var e=this,t=this.form.getFieldValue("interationName");if(console.log(t),t){var a={interationName:t,projectId:this.id};Object(b["d"])(a).then((function(t){console.log(t),t&&(e.$message.info("当前迭代名已存在，请重新输入"),e.form.setFieldsValue({interationName:""}),e.$nextTick((function(){this.$refs.myInput.focus()})))}))}}}},V=$,R=Object(N["a"])(V,F,P,!1,null,null,null),L=R.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{width:400,visible:e.visible,title:"筛选"},on:{ok:e.handleSubmit,cancel:e.cancel}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[e._v("\n              状态"),a("br"),a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["state"],expression:"['state']"}]},[a("a-radio",{attrs:{value:0}},[e._v("未开始")]),a("a-radio",{attrs:{value:1}},[e._v("开发中")]),a("a-radio",{attrs:{value:2}},[e._v("开发完成")]),a("a-radio",{attrs:{value:3}},[e._v("测试中")]),a("a-radio",{attrs:{value:4}},[e._v("测试完成")])],1)],1),a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[e._v("  处理人"),a("br"),a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["Name"],expression:"['Name']"}],ref:"myInput",attrs:{placeholder:"请输入项目处理人"}})],1)],1)],1)},K=[],q={name:"ScreenTask",components:{},data:function(){return{iterateId:0,labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:30}},visible:!1,tasks:[],data:[],form:this.$form.createForm(this)}},methods:{add:function(e){this.visible=!0,this.tasks=e},cancel:function(){this.visible=!1,this.form.resetFields()},handleSubmit:function(){var e=this.form.getFieldValue("state"),t=this.form.getFieldValue("Name");if(console.log(!0),0!=this.tasks.length)if(0==e||e||t)if(this.data=[],e)if(t){for(a=0;a<this.tasks.length;a++)e==this.tasks[a].taskState&&this.tasks[a].dealUserName&&this.tasks[a].dealUserName.indexOf(t)>=0&&this.data.push(this.tasks[a]);this.visible=!1,this.form.resetFields(),this.$emit("childFn",this.data)}else{for(a=0;a<this.tasks.length;a++)e==this.tasks[a].taskState&&this.data.push(this.tasks[a]);this.visible=!1,this.form.resetFields(),this.$emit("childFn",this.data)}else if(0==e){for(var a=0;a<this.tasks.length;a++)e==this.tasks[a].taskState&&this.data.push(this.tasks[a]);this.visible=!1,this.form.resetFields(),this.$emit("childFn",this.data)}else{for(var a=0;a<this.tasks.length;a++)this.tasks[a].dealUserName&&this.tasks[a].dealUserName.indexOf(t)>=0&&this.data.push(this.tasks[a]);this.visible=!1,this.form.resetFields(),this.$emit("childFn",this.data)}else;else this.visible=!1}}},E=q,U=Object(N["a"])(E,M,K,!1,null,null,null),A=U.exports,z={name:"Iterate",components:{TaskContent:_,AddIterateForm:L,ScreenTask:A},data:function(){return{startDate:"",endDate:"",iterateId:0,id:0,name:"",collapsed:!1,iterates:[],data:[],totalCount:0,tasks:[]}},mounted:function(){this.id=this.$route.query.id,this.name=this.$route.query.name,this.$refs.task.isNeed=!1,this.getIteratesById()},methods:{getIteratesById:function(){var e=this;console.log("projectId: "+this.id);var t={projectId:this.id};Object(b["b"])(t).then((function(t){if(console.log(t),e.data=t,0==t.length)console.log("hello world!!!"),e.$refs.task.isLoad();else{for(var a=!0,s=0;s<e.data.length;s++)if(1==e.data[s].interationPeriod){e.queryTask(e.data[s].interationId);var r=[e.data[s],e.data[0]];e.data[0]=r[0],e.data[s]=r[1],a=!1;break}a&&e.queryTask(e.data[0].interationId),console.log("111112222222222")}}))},queryTask:function(e){this.$refs.task.Load(),this.$refs.task.getValue(e),this.iterateId=e;for(var t=0;t<this.data.length;t++)e==this.data[t].interationId&&(this.iterates=this.data[t])},tagColor:function(e){return 0===e?"red":1===e?"orange":"green"},userState:function(e){return 0===e?"未开始":1===e?"进行中":"已完成"},appendToList:function(){this.getIteratesById()},parentFn:function(e){console.log("zmq11111111111111"),console.log(e),this.$refs.task.newTask(e)},getMsgFormSon:function(e){this.tasks=e,console.log("jajaajjaj"),console.log(e),null!=this.tasks&&(this.totalCount=e.length)}}},Y=z,G=Object(N["a"])(Y,n,o,!1,null,null,null),B=G.exports,W=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{style:{background:"#fff"}},[a("task-content")],1),a("a-modal",{attrs:{visible:e.organizeVisible,cancelText:"取消",okText:"确认"},on:{cancel:e.handleCancel,ok:e.handleConfirm}},[a("span",{staticClass:"common-head-font",attrs:{slot:"title"},slot:"title"},[e._v("上级组织选择")]),a("a-tree",{attrs:{expandedKeys:e.expandedKeysCopy,autoExpandParent:e.autoExpandParentCopy,treeData:e.treeData},on:{expand:e.onExpandCopy,select:e.onSelect}})],1),a("a-modal",{attrs:{visible:e.classDeal,width:800},on:{cancel:function(t){e.classDeal=!1},ok:function(t){e.classDeal=!1}}},[a("a-card",{staticStyle:{"margin-top":"10px"}},[a("template",{slot:"title"},[2==e.type?a("span",{staticClass:"common-head-font"},[e._v("修改任务")]):0==e.type?a("span",{staticClass:"common-head-font"},[e._v("新增分类")]):e._e()]),a("a-row",[a("a-form",{attrs:{form:e.form}},[a("a-col",{attrs:{span:11}},[a("a-form-item",{attrs:{label:"分类名称","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-row",{attrs:{gutter:100}},[a("a-col",{attrs:{span:21}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["className",{rules:[{required:!0,message:"请输入任务分类名称"}]}],expression:"[\n                                    'className',\n                                    {rules: [{ required: true, message: '请输入任务分类名称' }]}\n                                  ]"}]})],1)],1)],1)],1),a("a-col",{attrs:{span:11}},[a("a-form-item",{attrs:{label:"上级分类","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:21}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["parentClassId",{rules:[{required:!0,message:"请输入上级任务分类"}]}],expression:"[\n                                    'parentClassId',\n                                    {rules: [{ required: true, message: '请输入上级任务分类' }]}\n                                  ]"}],attrs:{disabled:!0}})],1)],1)],1)],1),a("a-col",{attrs:{span:2}},[a("a-form-item",{attrs:{"label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-icon",{staticStyle:{"font-size":"20px",color:"#18c4b0",cursor:"pointer"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addOrganize(t)}}})],1)],1)],1)],1),a("a-row",{attrs:{justify:"end",type:"flex"}},[a("a-button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.submitOrg}},[e._v("提交")])],1)],2)],1),a("a-modal",{attrs:{title:"再次确认",okText:"确认",cancelText:"取消"},on:{ok:e.hideModal},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("p",[e._v("确认要删除吗？")])])],1)},J=[],H=(a("5279"),a("9f92")),Q=a("22a0"),X=a("5fd0"),Z=a("a78e"),ee=[],te=function e(t,a){for(var s,r=0;r<a.length;r++){var i=a[r];i.children&&(i.children.some((function(e){return e.key===t}))?s=i.key:e(t,i.children)&&(s=e(t,i.children)))}return s},ae={components:{ARow:Z["a"],ACol:X["b"],AModal:f["a"],TaskContent:H["a"]},name:"taskSort",methods:{hideModal:function(){var e=this;Object(Q["a"])({type:1,classId:this.selectedKeys}).then((function(t){e.$message.success(t),e.form.setFieldsValue({className:"",parentClassId:""}),e.formCopy.setFieldsValue({parentClassId:""}),e.getData()})),this.visible=!1},removeAuth:function(){this.visible=!0},addAuth:function(){var e=this;this.classDeal=!0,this.addRelatOrgId=this.selectedKeys,this.type=0,this.formCopy.setFieldsValue({countId:"",parentClassId:this.getOrgName(this.selectedKeys)});var t=this.form.setFieldsValue;this.$nextTick((function(){t({className:"",parentClassId:e.getOrgName(e.selectedKeys)})}))},onSelect:function(e){this.Count?this.selectedKeysCopy=e[0]:this.selectedKeys=e[0]},getOrgId:function(e){for(var t,a=0;a<ee.length;a++)e==ee[a].title&&(t=ee[a].key);return t},submitOrg:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var s={className:a.className,parentClassId:e.type&&0!=e.type?e.relatOrgId1:e.addRelatOrgId,type:e.type?e.type:0,classId:e.type&&0!=e.type?e.getOrgId(e.oldOrgName):""};Object(Q["a"])(s).then((function(t){e.$message.success(t),e.form.setFieldsValue({className:"",parentClassId:""}),e.getData(),e.classDeal=!1}))}}))},onExpandCopy:function(e){this.expandedKeysCopy=e,this.autoExpandParentCopy=!1},handleConfirm:function(){this.formCopy.setFieldsValue({parentClassId:this.getOrgName(this.selectedKeysCopy)}),this.form.setFieldsValue({parentClassId:this.getOrgName(this.selectedKeys)}),this.organizeVisible=!1,this.selectedKeys&&(this.deleteLable=!0),this.selectedKeysCopy&&(this.deleteLableCopy=!0)},handleCancel:function(){this.organizeVisible=!1},addOrganize:function(){this.Count=!1,this.organizeVisible=!0},getNextOrg:function(e,t,a){for(var s=0;s<e.length;s++){var r=e[s];r.key==t?a.push(r.parent):r.children&&this.getNextOrg(r.children,t,a)}return this.getOrgName(a[0])},getOrgName:function(e){for(var t,a=0;a<ee.length;a++)e==ee[a].key&&(t=ee[a].title);return t},editAuth:function(e){var t=this;this.type=2;var a=[];this.oldOrgName=this.getOrgName(this.selectedKeys),this.relatOrgId1=te(this.selectedKeys,this.treeData),this.classDeal=!0;var s=this.form.setFieldsValue;this.$nextTick((function(){s({className:t.getOrgName(t.selectedKeys),parentClassId:t.getNextOrg(t.treeData,t.selectedKeys,a)})}))},getArray:function(e,t){for(var a=0;a<e.length;a++)t.push({className:e[a].className,classId:e[a].classId}),e[a].child&&e[a].child.result&&this.getArray(e[a].child.result,t);return t},searchMenu:function(e){for(var t=0;t<e.length;t++)e[t].title=e[t].className,e[t].key=e[t].classId,e[t].scopedSlots={title:"title"},e[t].parent=e.parentId,e[t].child&&e[t].child.result&&(e[t].children=e[t].child.result,e[t].children.parentId=e[t].classId,this.searchMenu(e[t].child.result))},onChange:function(e){var t=this,a=e.target.value,s=ee.map((function(e){return e.title.indexOf(a)>-1?te(e.key,t.treeData):null})).filter((function(e,t,a){return e&&a.indexOf(e)===t}));Object.assign(this,{expandedKeys:s,searchValue:a,autoExpandParent:!0})},getData:function(){var e=this;Object(Q["b"])({taskId:7}).then((function(t){e.treeData=Array.of(t),e.searchMenu(Array.of(t));var a=function e(t){for(var a=0;a<t.length;a++){var s=t[a],r=s.key;ee.push({key:r,title:s.title}),s.children&&e(s.children,s.key)}};a(Array.of(t))}))},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1}},mounted:function(){this.getData()},data:function(){return{relatOrgId1:"",addRelatOrgId:"",oldOrgName:"",treeDatas:[],deleteLableCopy:!1,deleteLable:!1,autoExpandParentCopy:!0,expandedKeysCopy:[],formItemLayout:{labelCol:{span:6},wrapperCol:{span:16}},type:"",organizeVisible:!1,classDeal:!1,Count:"",form:this.$form.createForm(this),formCopy:this.$form.createForm(this),selectedKeys:[],selectedKeysCopy:[],searchValue:"",expandedKeys:[],autoExpandParent:!0,treeData:[],createType:"",visible:!1}}},se=ae,re=(a("ed1e"),a("d048"),Object(N["a"])(se,W,J,!1,null,"7036de57",null)),ie=re.exports,ne=a("e7ea"),oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",{attrs:{bordered:!1}},[a("Member",{ref:"Member",on:{childFn:e.parentFn}}),a("div",[a("span",{staticStyle:{color:"red"}},[a("a-icon",{staticStyle:{"padding-top":"10px"},attrs:{type:"info-circle"}}),e._v("\n          点击表格行可修改成员角色\n        ")],1),a("span",[a("a-button",{staticStyle:{"margin-left":"540px"},attrs:{type:"primary"},on:{click:function(t){return e.$refs.Member.add(e.projectId,e.roleList)}}},[a("a-icon",{attrs:{type:"user-add"}}),e._v("添加成员\n        ")],1),a("a-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger"},on:{click:e.removeMembers}},[a("a-icon",{attrs:{type:"user-delete"}}),e._v("删除成员\n           ")],1)],1)]),a("a-table",{ref:"table",staticStyle:{cursor:"pointer"},attrs:{size:"default",columns:e.columns,dataSource:e.loadData,alert:!1,loading:e.loading,rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},customRow:e.rowClick},scopedSlots:e._u([e._l(["roleNameList"],(function(t){return{key:t,fn:function(s,r,i){return["roleNameList"==t?a("div",e._l(s,(function(t,s){return a("div",[a("a-tag",{key:s},[e._v(e._s(t))])],1)})),0):e._e()]}}}))],null,!0)})],1),a("a-modal",{attrs:{visible:e.choseIterVisiable,title:"分配角色"},on:{cancel:e.cancel,ok:e.commit}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"成员名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["projectName"],expression:"['projectName']"}],attrs:{disabled:"disabled"}})],1),a("a-form-item",{attrs:{label:"成员角色",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["projectRole",{rules:[{required:!0,message:"请选择角色"}]}],expression:"['projectRole', {rules:[{required: true, message: '请选择角色'}]}]"}],attrs:{mode:"multiple",placeholder:"请选择角色"}},e._l(e.roleList,(function(t){return a("a-select-option",{key:t.id},[e._v(e._s(t.roleName))])})),1)],1),a("a-form-item",{attrs:{label:"所属部门",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["org"],expression:"['org']"}],attrs:{disabled:"disabled"}})],1),a("a-form-item",{attrs:{label:"邮箱",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mail"],expression:"['mail']"}],attrs:{disabled:"disabled"}})],1)],1)],1)],1)},le=[],ce=(a("f301"),a("df99"),a("1bff")),de=a("2af9"),ue=a("b70d"),he=a("0fea"),fe=a("4a6a"),me=a("08c1"),pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{width:1200,visible:e.visible,title:"添加成员"},on:{ok:e.handleSubmit,cancel:function(t){return e.cancel()}}},[a("template",{slot:"footer"},[a("div",[a("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择角色"},on:{change:e.handleChange}},e._l(e.roleList,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v(e._s(t.roleName))])})),1)],1),a("br"),a("a-button",{key:"back",on:{click:function(t){return e.cancel()}}},[e._v("取消")]),a("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleSubmit}},[e._v("\n                       确认\n              ")])],1),a("a-row",{attrs:{gutter:8}},[a("a-col",{attrs:{span:5}},[a("a-directory-tree",{attrs:{defaultExpandAll:e.autoExpandParent,treeData:e.treeData},on:{select:e.onSelect}})],1),a("a-col",{attrs:{span:19}},[a("a-table",{ref:"table",attrs:{loading:e.loading,size:"default",columns:e.columns,dataSource:e.loadData,alert:!1,rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange}},scopedSlots:e._u([{key:"filterDropdown",fn:function(t){var s=t.setSelectedKeys,r=t.selectedKeys,i=t.confirm,n=t.clearFilters,o=t.column;return a("div",{staticClass:"custom-filter-dropdown"},[a("a-input",{directives:[{name:"ant-ref",rawName:"v-ant-ref",value:function(t){return e.searchInput=t},expression:"c => searchInput = c"}],staticStyle:{width:"188px","margin-bottom":"8px",display:"block"},attrs:{placeholder:"Search "+o.dataIndex,value:r[0]},on:{change:function(e){return s(e.target.value?[e.target.value]:[])},pressEnter:function(){return e.handleSearch(r,i)}}}),a("a-button",{staticStyle:{width:"90px","margin-right":"8px"},attrs:{type:"primary",icon:"search",size:"small"},on:{click:function(){return e.handleSearch(r,i)}}},[e._v("查询")]),a("a-button",{staticStyle:{width:"90px"},attrs:{size:"small"},on:{click:function(){return e.handleReset(n)}}},[e._v("重置")])],1)}},{key:"filterIcon",fn:function(e){return a("a-icon",{style:{color:e?"#108ee9":void 0},attrs:{type:"search"}})}},{key:"name",fn:function(t){return[a("a",{attrs:{href:"javascript:;"}},[e._v(e._s(t))])]}}])})],1)],1)],2)},ge=[],be=a("e0a5"),ye={name:"MemberManager",components:{STable:de["q"],STree:ce["a"],OrgModal:ue["a"]},data:function(){var e,t=this;return e={roleList:[],visible:!1,searchText:"",searchInput:null,openKeys:["key-01"],expandedKeys:[],autoExpandParent:!0,treeData:[],columns:[{title:"姓名",dataIndex:"userName",key:"userName",scopedSlots:{filterDropdown:"filterDropdown",filterIcon:"filterIcon",customRender:"customRender"},onFilter:function(e,t){return t.userName.toLowerCase().includes(e.toLowerCase())},onFilterDropdownVisibleChange:function(e){e&&setTimeout((function(){t.searchInput.focus()}),0)}},{title:"所属部门",dataIndex:"orgName",key:"orgName"},{title:"邮箱",dataIndex:"mail",key:"mail"},{title:"手机号",dataIndex:"phoneNum",key:"phoneNum"}],loadData:[],orgTree:[],selectedRowKeys:[],selectedRows:[],id:0,loading:!1,users:[],keys:0},Object(u["a"])(e,"visible",!1),Object(u["a"])(e,"projectId",0),Object(u["a"])(e,"selectValue",0),Object(u["a"])(e,"description",""),e},methods:(w={add:function(e){console.log("aaaaaaaabbbbbbbbbb"),this.visible=!0,this.projectId=e,this.getData(),this.queryRole()},handleSubmit:function(){0==this.selectedRows.length?this.$message.info("请选择成员"):0==this.selectValue?this.$message.info("请分配角色"):this.addMembers()},cancel:function(){this.visible=!1},getUsers:function(e){var t=this;Object(v["h"])({projectId:e}).then((function(e){t.users=e}))},queryRole:function(){var e=this;Object(be["c"])({roleType:2}).then((function(t){e.roleList=t}))},addMembers:function(){for(var e=this,t=[],a=0;a<this.selectedRows.length;a++)t.push(this.selectedRows[a].userId);var s=[];s.push(this.selectValue);var r={userIdList:t,projectId:this.projectId,projectRole:s};Object(v["a"])(r).then((function(t){if(console.log(t),0==t.length)e.visible=!1,e.$message.success("添加成功"),e.$emit("childFn"),e.selectedRows=[],e.selectedRowKeys=[];else{e.description="";for(var a=0;a<t.length;a++)e.description=e.description+t[a]+"、";e.description=e.description+"已经在该项目中",e.openNotificationWithIcon("warning")}}))},addMember:function(e){var t=[];t.push(e.userId);var a={userId:t,projectId:this.id};this.$refs.per.add(a)},removeMember:function(e){var t=this,a=[];a.push(e.userId);var s={userIdList:a,projectId:this.id};Object(v["m"])(s).then((function(e){t.$message.success("移除成功"),t.getUsers(),t.onSelect(t.keys)}))},removeMembers:function(){var e=this;if(null!=this.users){for(var t=0;t<this.selectedRows.length;t++){for(var a=!1,s=0;s<this.users.length;s++)this.selectedRows[t].userId==this.users[s].userId&&(a=!0);if(!a)return void this.$message.info("不能移除不在项目中的成员")}var r=[];for(t=0;t<this.selectedRows.length;t++)r.push(this.selectedRows[t].userId);var i={userIdList:r,projectId:this.id};Object(v["m"])(i).then((function(t){e.$message.success("移除成功"),e.getUsers(),e.onSelect(e.keys),e.selectedRows=[],e.selectedRowKeys=[]}))}else this.$message.info("不能移除不在项目中的成员")},checkUser:function(e){if(null==this.users)return!1;for(var t=0;t<this.users.length;t++)if(e.userId==this.users[t].userId)return!0;return!1},openNotificationWithIcon:function(e){this.$notification[e]({message:"添加失败",description:this.description})},array_difference:function(e,t){for(var a=0;a<e.length;a++)for(var s=0;s<t.length;s++)e[a].userId===t[s].userId&&e.splice(a,1);return e},handleChange:function(e){this.selectValue=e,console.log(e),console.log(this.selectValue)},start:function(){this.selectedRowKeys=[]}},Object(u["a"])(w,"cancel",(function(){this.visible=!1})),Object(u["a"])(w,"handleClick",(function(e){console.log("handleClick",e),this.queryParam={key:e.key},this.$refs.table.refresh(!0)})),Object(u["a"])(w,"handleAdd",(function(e){console.log("add button, item",e),this.$message.info("提示：你点了 ".concat(e.key," - ").concat(e.title," ")),this.$refs.modal.add(e.key)})),Object(u["a"])(w,"handleTitleClick",(function(e){console.log("handleTitleClick",e)})),Object(u["a"])(w,"titleClick",(function(e){console.log("titleClick",e)})),Object(u["a"])(w,"handleSaveOk",(function(){})),Object(u["a"])(w,"handleSaveClose",(function(){})),Object(u["a"])(w,"onSelectChange",(function(e,t){this.selectedRowKeys=e,this.selectedRows=t,console.log(e,t)})),Object(u["a"])(w,"handleSearch",(function(e,t){t(),this.searchText=e[0]})),Object(u["a"])(w,"handleReset",(function(e){e(),this.searchText=""})),Object(u["a"])(w,"onExpand",(function(e){this.expandedKeys=e,this.autoExpandParent=!1})),Object(u["a"])(w,"getData",(function(){var e=this;Object(fe["c"])({orgId:11}).then((function(t){e.treeData=Array.of(t),e.searchMenu(Array.of(t)),console.log(e.treeData)}))})),Object(u["a"])(w,"searchMenu",(function(e){for(var t=0;t<e.length;t++)e[t].title=e[t].orgName,e[t].key=e[t].orgId,e[t].scopedSlots={title:"title"},e[t].parent=e.parentId,e[t].child&&e[t].child.result&&(e[t].children=e[t].child.result,e[t].children.parentId=e[t].child.orgRelatId,this.searchMenu(e[t].child.result))})),Object(u["a"])(w,"onSelect",(function(e){var t=this;this.keys=e,this.loading=!0,Object(v["g"])({orgId:e}).then((function(e){if(console.log(e),null!=e)for(var a=0;a<e.length;a++)e[a].key=e[a].userId;t.loadData=e,t.selectedRows=[],t.selectedRowKeys=[],t.loading=!1}))})),Object(u["a"])(w,"parentFn",(function(){this.getUsers(),this.onSelect(this.keys),this.selectedRows=[],this.selectedRowKeys=[]})),w)},ve=ye,ke=(a("74b6"),Object(N["a"])(ve,pe,ge,!1,null,null,null)),Ie=ke.exports;function we(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function je(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?we(Object(a),!0).forEach((function(t){Object(u["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):we(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ce={name:"ProjectMembers",components:{STable:de["q"],STree:ce["a"],OrgModal:ue["a"],Member:Ie},data:function(){var e=this;return{disabled:!0,labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:13}},choseIterVisiable:!1,visible:!1,loading:!0,searchText:"",searchInput:null,openKeys:["key-01"],expandedKeys:[],autoExpandParent:!0,treeData:[],columns:[{title:"姓名",dataIndex:"userName",key:"userName",scopedSlots:{filterDropdown:"filterDropdown",filterIcon:"filterIcon",customRender:"customRender"},onFilter:function(e,t){return t.name.toLowerCase().includes(e.toLowerCase())},onFilterDropdownVisibleChange:function(t){t&&setTimeout((function(){e.searchInput.focus()}),0)}},{title:"角色",dataIndex:"roleNameList",key:"roleNameList",scopedSlots:{customRender:"roleNameList"}},{title:"所属部门",dataIndex:"orgName",key:"orgName"},{title:"邮箱",dataIndex:"mail",key:"mail"},{title:"手机号码",dataIndex:"phoneNum",key:"phoneNum"},{title:"进入项目时间",dataIndex:"createDate",key:"createDate"}],loadData:[],orgTree:[],roleList:[],form:this.$form.createForm(this),selectedRowKeys:[],selectedRows:[],projectId:0,userId:0,rowClick:function(t){return{on:{click:function(){e.choseIterVisiable=!0,e.userId=t.userId,e.form.getFieldDecorator("projectName",{initialValue:t.userName}),e.form.getFieldDecorator("org",{initialValue:t.orgName}),e.form.getFieldDecorator("mail",{initialValue:t.mail})}}}}}},mounted:function(){this.projectId=this.$route.query.id,this.getUsers(this.projectId),this.queryRole()},computed:je({},Object(me["c"])(["userInfo"])),created:function(){var e=this;Object(he["a"])().then((function(t){e.orgTree=t.result}))},methods:{handleSubmit:function(){},commit:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var s={projectId:e.projectId,userId:e.userId,roleIdList:a.projectRole};console.log(s),Object(v["j"])(s).then((function(t){e.$message.success("修改角色成功"),e.getUsers(e.projectId),e.choseIterVisiable=!1,e.form.resetFields()}))}}))},handleChange:function(e){this.roleListId=e},queryRole:function(){var e=this;Object(be["c"])({roleType:2}).then((function(t){e.roleList=t,console.log(t,"roleList")}))},getUsers:function(e){var t=this;this.loading=!0,Object(v["h"])({projectId:e}).then((function(e){if(console.log(e),t.loadData=e,null!=e){for(var a=0;a<e.length;a++)e[a].key=e[a].userId;setTimeout((function(){t.loading=!1}),500)}else t.loading=!1}))},cancel:function(){this.choseIterVisiable=!1,this.form.resetFields()},parentFn:function(){this.getUsers(this.projectId)},handleClick:function(e){console.log("handleClick",e),this.queryParam={key:e.key},this.$refs.table.refresh(!0)},handleAdd:function(e){console.log("add button, item",e),this.$message.info("提示：你点了 ".concat(e.key," - ").concat(e.title," ")),this.$refs.modal.add(e.key)},handleTitleClick:function(e){console.log("handleTitleClick",e)},titleClick:function(e){console.log("titleClick",e)},handleSaveOk:function(){},handleSaveClose:function(){},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t,console.log(e,t)},handleSearch:function(e,t){t(),this.searchText=e[0]},handleReset:function(e){e(),this.searchText=""},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},addMembers:function(){for(var e=this,t=[],a=0;a<this.selectedRows.length;a++)t.push(this.selectedRows[a].userId);this.projectId;Object(v["a"])(value).then((function(t){e.visible=!1,e.$message.success("添加成功")}))},removeMembers:function(){var e=this;if(0!=this.selectedRows.length){for(var t=[],a=0;a<this.selectedRows.length;a++)t.push(this.selectedRows[a].userId);var s={userIdList:t,projectId:this.projectId};Object(v["m"])(s).then((function(t){e.$message.success("移除成功"),e.getUsers(e.projectId),e.selectedRows=[],e.selectedRowKeys=[]}))}else this.$message.info("请选择成员")},getData:function(){var e=this;Object(fe["c"])({orgId:11}).then((function(t){e.treeData=Array.of(t),e.searchMenu(Array.of(t)),console.log(e.treeData)}))},searchMenu:function(e){for(var t=0;t<e.length;t++)e[t].title=e[t].orgName,e[t].key=e[t].orgId,e[t].scopedSlots={title:"title"},e[t].parent=e.parentId,e[t].child&&e[t].child.result&&(e[t].children=e[t].child.result,e[t].children.parentId=e[t].child.orgRelatId,this.searchMenu(e[t].child.result))},onSelect:function(e){var t=this;getUserByOrgId({orgId:e}).then((function(e){console.log(e),t.loadData=e}))}}},Oe=Ce,Se=(a("26b6"),Object(N["a"])(Oe,oe,le,!1,null,null,null)),De=Se.exports,xe={name:"Tab",components:{Iterate:B,Task:ie,Display:ne["default"],ProjectMembers:De},data:function(){return{name:"",activekey:0,id:0,isShowIterate:!0,isShowTask:!1,isShowDisplay:!1,isShowMember:!1}},mounted:function(){this.name=this.$route.query.name},methods:{handleCallback:function(e){this.activekey=e,"1"==e?(this.isShowIterate=!0,this.isShowTask=!1,this.isShowDisplay=!1,this.isShowMember=!1):"2"==e?(this.isShowIterate=!1,this.isShowTask=!0,this.isShowDisplay=!1):"3"==e?(this.isShowIterate=!1,this.isShowTask=!1,this.isShowDisplay=!0,this.isShowMember=!1):"4"==e&&(this.isShowIterate=!1,this.isShowTask=!1,this.isShowDisplay=!1,this.isShowMember=!0)}}},Ne=xe,Te=Object(N["a"])(Ne,r,i,!1,null,null,null);t["default"]=Te.exports},"24d2":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"l",(function(){return o})),a.d(t,"k",(function(){return l})),a.d(t,"i",(function(){return c})),a.d(t,"e",(function(){return d})),a.d(t,"h",(function(){return u})),a.d(t,"g",(function(){return h})),a.d(t,"a",(function(){return f})),a.d(t,"m",(function(){return m})),a.d(t,"f",(function(){return p})),a.d(t,"j",(function(){return g}));var s=a("0c6d");function r(e){return s["a"].fetchP({url:"/teamwork-api/project/addProjectInfo",data:e})}function i(e){return s["a"].fetchG({url:"/teamwork-api/project/findAllProjectInfo",data:e})}function n(e){return s["a"].fetchG({url:"/teamwork-api/project/deleteProjectInfo",data:e})}function o(e){return s["a"].fetchG({url:"/teamwork-api/project/findProjectByProjectName",data:e})}function l(e){return s["a"].fetchG({url:"/teamwork-api/project/findPreciseProject",data:e})}function c(e){return s["a"].fetchP({url:"/teamwork-api/project/updateProjectInfo",data:e})}function d(e){return s["a"].fetchG({url:"/teamwork-api/project/getProjectNumber",data:e})}function u(e){return s["a"].fetchG({url:"/teamwork-api/project/queryStaffInfoByProjectId",data:e})}function h(e){return s["a"].fetchG({url:"/teamwork-api/project/queryStaffInfoByOrgId",data:e})}function f(e){return s["a"].fetchP({url:"/teamwork-api/project/addProjectMember",data:e})}function m(e){return s["a"].fetchG({url:"/teamwork-api/project/deleteProjectMember",data:e})}function p(e){return s["a"].fetchG({url:"/teamwork-api/project/queryProjectType",data:e})}function g(e){return s["a"].fetchG({url:"/teamwork-api/project/updateProjectMemberRole",data:e})}},"26b6":function(e,t,a){"use strict";var s=a("e42d"),r=a.n(s);r.a},"4a6a":function(e,t,a){"use strict";a.d(t,"d",(function(){return r})),a.d(t,"e",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return l})),a.d(t,"f",(function(){return c}));var s=a("0c6d");function r(e){return s["a"].fetchP({url:"/teamwork-api/cust/modifyStaffName",data:e})}function i(e){return s["a"].fetchG({url:"/teamwork-api/cust/modifyPassword",data:e})}function n(e){return s["a"].fetchG({url:"/teamwork-api/sec/getSecOrgByOrgId",data:e})}function o(e){return s["a"].fetchP({url:"/teamwork-api/sec/saveSecOrg",data:e})}function l(e){return s["a"].fetchG({url:"/teamwork-api/sec/getSecAccAuthByOrgIdAndUserId",data:e})}function c(e){return s["a"].fetchP({url:"/teamwork-api/sec/saveUserInfo",data:e})}},"74b6":function(e,t,a){"use strict";var s=a("165b"),r=a.n(s);r.a},"8ab4":function(e,t,a){"use strict";var s=a("c21c"),r=a.n(s);r.a},"997a":function(e,t,a){},b70d:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"操作",width:600,visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleOk,cancel:e.handleCancel}},[a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{attrs:{label:"父级ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["parentId",{}],expression:"['parentId', {}]"}],attrs:{disabled:""}})],1),a("a-form-item",{attrs:{label:"机构名称"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["orgName",{}],expression:"['orgName', {}]"}]})],1)],1)],1)],1)},r=[],i=(a("2338"),a("f763"),a("fb37"),a("f010"));function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={name:"OrgModal",data:function(){return{labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},visible:!1,confirmLoading:!1,mdl:{}}},beforeCreate:function(){this.form=this.$form.createForm(this),console.log("form::",this.form)},created:function(){},methods:{add:function(e){this.edit({parentId:e})},edit:function(e){var t=this;this.mdl=Object.assign({},e),this.visible=!0,this.$nextTick((function(){t.form.setFieldsValue(o({},e))}))},close:function(){this.$emit("close"),this.visible=!1},handleOk:function(){var e=this;this.form.validateFields((function(t,a){t||(console.log("form values",a),e.confirmLoading=!0,new Promise((function(e){setTimeout((function(){return e()}),2e3)})).then((function(){e.$message.success("保存成功"),e.$emit("ok")})).catch((function(){})).finally((function(){e.confirmLoading=!1,e.close()})))}))},handleCancel:function(){this.close()}}},c=l,d=a("4e82"),u=Object(d["a"])(c,s,r,!1,null,null,null);t["a"]=u.exports},c21c:function(e,t,a){},d048:function(e,t,a){"use strict";var s=a("ec95"),r=a.n(s);r.a},e42d:function(e,t,a){},ec95:function(e,t,a){},ed1e:function(e,t,a){"use strict";var s=a("997a"),r=a.n(s);r.a}}]);