(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-30a628e4"],{"202e":function(e,t,a){"use strict";var i=a("8c09"),n=a.n(i);n.a},"8c09":function(e,t,a){},ad2f:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return p}));var i=a("0c6d"),n=(a("08c1"),a("4360")),s=a("e1d2");function r(e){return i["a"].fetchG({url:"/teamwork-api/sec/getSecMenus",data:e})}function o(e){return i["a"].fetchP({url:"/teamwork-api/sec/saveSecMenus",data:e})}function u(e){return i["a"].fetchG({url:"/teamwork-api/sec/generateBusinessId",data:e})}var l=!1,c=function e(t,a){for(var i=0;i<a.length;i++){var n=a[i];n&&(n.businessId&&n.businessId===t?l=!0:a[i].secMenuDOS&&e(t,a[i].secMenuDOS))}};function p(e){var t=n["a"].state.MenuData.menuData;return t&&0===t.length?(t=s["a"].getMenuData2({userId:n["a"].state.userContext.userInfo.staffId}),l=!1,c(e,t),l):(l=!1,c(e,t),l)}},c23f:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"10px"}},[a("a-row",{attrs:{gutter:20}},[a("a-col",{attrs:{span:7}},[a("MenuSide",{ref:"refs",on:{editAuth:e.mainSide}})],1),a("a-col",{attrs:{span:17}},[a("MainContext",{ref:"side",attrs:{mainContext:e.Value,functions:this.$refs,authValue:e.authValue}})],1)],1)],1)},n=[],s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container",style:{minHeight:"addPreMenu"==e.type?"300px":"550px"}},[a("a-input-search",{staticStyle:{"margin-bottom":"8px"},attrs:{placeholder:"Search"},on:{change:e.onChange}}),a("a-tree",{attrs:{expandedKeys:e.expandedKeys,autoExpandParent:e.autoExpandParent,selectedKeys:e.selectedKeys,treeData:e.treeData},on:{expand:e.onExpand,select:e.onSelect},scopedSlots:e._u([{key:"title",fn:function(t){return[t.title.indexOf(e.searchValue)>-1?a("span",{staticStyle:{"font-size":"smaller"}},[e._v("\n\t\t\t\t\t"+e._s(t.title.substr(0,t.title.indexOf(e.searchValue)))+"\n\t\t\t\t\t"),a("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchValue))]),e._v("\n\t\t\t\t\t"+e._s(t.title.substr(t.title.indexOf(e.searchValue)+e.searchValue.length))+"\n\t\t\t\t\t"),e.isOper&&-1!=e.selectedKeys.indexOf(t.key)&&9999===t.key?a("span",[-1===t.title.indexOf("(权限)")&&e.isAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加子菜单")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addAuth(t)}}})],2):e._e()],1):-1!=e.selectedKeys.indexOf(t.key)&&"addPreMenu"!==e.type?a("span",[e.isEdit?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("修改")])]),a("a-icon",{attrs:{type:"edit"},on:{click:function(t){return t.stopPropagation(),e.editAuth(t)}}})],2):e._e(),-1===t.title.indexOf("(权限)")&&e.isAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加子菜单")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addAuth(t)}}})],2):e._e(),e.isDelete?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("删除")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"minus-circle"},on:{click:function(t){return t.stopPropagation(),e.removeAuth1(t)}}})],2):e._e(),-1===t.title.indexOf("(权限)")&&e.isAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加权限")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-square"},on:{click:function(t){return t.stopPropagation(),e.addAuthNew(t)}}})],2):e._e()],1):e._e()]):a("span",{staticStyle:{"font-size":"smaller"}},[e._v("\n\t\t\t\t\t"+e._s(t.title)+"\n\t\t\t\t\t"),-1!=e.selectedKeys.indexOf(t.key)&&9999===t.key?a("span",[e.isAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加子菜单")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addAuth(t)}}})],2):e._e()],1):-1!=e.selectedKeys.indexOf(t.key)?a("span",[e.isEdit?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("修改")])]),a("a-icon",{attrs:{type:"edit"},on:{click:function(t){return t.stopPropagation(),e.editAuth(t)}}})],2):e._e(),-1===t.title.indexOf("(权限)")&&e.isAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加子菜单")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addAuth(t)}}})],2):e._e(),e.isDelete?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("删除")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"minus-circle"},on:{click:function(t){return t.stopPropagation(),e.removeAuth1(t)}}})],2):e._e(),-1===t.title.indexOf("(权限)")&&e.isAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加权限")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-square"},on:{click:function(t){return t.stopPropagation(),e.addAuthNew(t)}}})],2):e._e()],1):e._e()])]}}])}),a("a-modal",{attrs:{title:"再次确认",okText:"确认",cancelText:"取消"},on:{ok:e.hideModal},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("p",[e._v("确认要删除吗？")])])],1)},r=[],o=a("ad2f"),u=function e(t,a){for(var i,n=0;n<a.length;n++){var s=a[n];s.children&&(s.children.some((function(e){return e.key===t}))?i=s.key:e(t,s.children)&&(i=e(t,s.children)))}return i},l={props:{type:{type:String,default:""},isOper:{type:Boolean,default:!0}},data:function(){return{expandedKeys:[],autoExpandParent:!0,selectedKeys:[],searchValue:"",treeData:[],dataList:[],visible:!1,query:1047,add:1049,edit:1048,delete:1050,isHasQuery:!1,isAdd:!1,isEdit:!1,isDelete:!1}},computed:{},watch:{},created:function(){},methods:{hideModal:function(){this.removeAuth(),this.visible=!1},onChange:function(e){var t=this,a=e.target.value,i=this.dataList.map((function(e){return e.title.indexOf(a)>-1?u(e.key,t.treeData):null})).filter((function(e,t,a){return e&&a.indexOf(e)===t}));Object.assign(this,{expandedKeys:i,searchValue:a,autoExpandParent:!0})},getOrgName:function(e){for(var t=[],a=0;a<this.dataList.length;a++)e[0]==this.dataList[a].key&&t.push({title:this.dataList[a].title,key:e[0]});return t},getOrgId:function(e){for(var t,a=0;a<this.dataList.length;a++)e==this.dataList[a].title&&(t=this.dataList[a].key);return t},editAuth:function(){this.$emit("editAuth",this.getOrgName(this.selectedKeys),"edit",this.treeData)},addAuthNew:function(){this.$emit("editAuth",this.getOrgName(this.selectedKeys),"addAuthNew",this.treeData)},addAuth:function(){this.$emit("editAuth",this.getOrgName(this.selectedKeys),"add",this.treeData)},removeAuth1:function(){this.visible=!0},removeAuth:function(){var e=this;this.$emit("editAuth",this.getOrgName(this.selectedKeys),"remove"),Object(o["d"])({type:1,menuId:this.selectedKeys[0]}).then((function(t){e.$message.success(t),e.getTree()}))},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},onSelect:function(e,t){var a=this;if(this.selectedKeys=e,this.selectedKeys.length>0){var i=this.dataList.filter((function(e){return e.key===a.selectedKeys[0]}));this.$emit("selectedItem",i[0])}},searchMenu:function(e){for(var t=0;t<e.length;t++){var a=0==e[t].menuType?"菜单":"权限";e[t].title=e[t].menuName+"("+a+")",e[t].key=e[t].menuId,e[t].scopedSlots={title:"title"},e[t].child&&(e[t].children=e[t].child,this.searchMenu(e[t].child))}},addMenu:function(e){var t=[];return t.push({title:"权限控制",key:9999,children:e,scopedSlots:{title:"title"}}),t},getTree:function(){var e=this;this.dataList=[],Object(o["b"])().then((function(t){e.searchMenu(t),t=e.addMenu(t),e.treeData=t;var a=function t(a){for(var i=0;i<a.length;i++){var n=a[i],s=n.key;e.dataList.push({key:s,title:n.title}),n.children&&t(n.children,n.key)}};console.log("dad",e.dataList),a(t)}))},judgeIsAuth:function(e){for(var t=0;t<e.length;t++){var a=e[t];a&&(a.businessId&&a.businessId===this.query?this.isHasQuery=!0:e[t].secMenuDOS&&this.judgeIsAuth(e[t].secMenuDOS))}}},mounted:function(){this.isHasQuery=Object(o["c"])(this.query),this.isHasQuery&&(this.getTree(),this.isAdd=Object(o["c"])(this.add),this.isEdit=Object(o["c"])(this.edit),this.isDelete=Object(o["c"])(this.delete))}},c=l,p=(a("202e"),a("4e82")),h=Object(p["a"])(c,s,r,!1,null,"e7ebe228",null),d=h.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",[a("template",{slot:"title"},[a("span",{staticClass:"common-head-font"},[e._v("菜单权限")])]),a("a-row",[a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"父级菜单","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:21}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["menuPreMenu"],expression:"[\n                                  'menuPreMenu'\n                                ]"}],attrs:{disabled:!0,value:e.preMenuData?e.preMenuData.title:""}})],1),a("a-col",{attrs:{span:3}},[e.preMenuData?a("a-icon",{staticStyle:{"font-size":"20px",color:"#18c4b0",cursor:"pointer"},attrs:{type:"minus-circle"},on:{click:function(t){e.preMenuData=void 0}}}):a("a-icon",{staticStyle:{"font-size":"20px",color:"#18c4b0",cursor:"pointer"},attrs:{type:"plus-circle"},on:{click:function(t){e.authVisible=!0,e.modalType="preMenu"}}})],1)],1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"菜单名称","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["menuName"],expression:"[\n                              'menuName',\n                            ]"}],model:{value:e.menuName,callback:function(t){e.menuName=t},expression:"menuName"}})],1)],1)],1),a("a-row",[a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"菜单路径","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["menuPath"],expression:"[\n                              'menuPath',\n                            ]"}],model:{value:e.menuPath,callback:function(t){e.menuPath=t},expression:"menuPath"}})],1)],1)],1),a("a-row",{attrs:{justify:"end",type:"flex"}},[a("a-button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.menuAuthority}},[e._v("提交")])],1)],2),a("a-card",{staticStyle:{"margin-top":"20px"}},[a("template",{slot:"title"},[a("span",{staticClass:"common-head-font"},[e._v("操作权限")])]),a("a-row",[a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"父级菜单","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:21}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["operatePreMenu"],expression:"[\n                                      'operatePreMenu',\n                                    ]"}],attrs:{disabled:!0,value:e.operatePreMenuData?e.operatePreMenuData.title:""}})],1),a("a-col",{attrs:{span:3}},[e.operatePreMenuData?a("a-icon",{staticStyle:{"font-size":"20px",color:"#18c4b0",cursor:"pointer"},attrs:{type:"minus-circle"},on:{click:function(t){e.operatePreMenuData=void 0}}}):a("a-icon",{staticStyle:{"font-size":"20px",color:"#18c4b0",cursor:"pointer"},attrs:{type:"plus-circle"},on:{click:e.operateAuthorityPage}})],1)],1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"操作ID","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["operateId"],expression:"[\n                              'operateId',\n                            ]"}],staticStyle:{width:"100%"},attrs:{disabled:!0},model:{value:e.operationId,callback:function(t){e.operationId=t},expression:"operationId"}})],1)],1)],1),a("a-row",[a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"操作名称","label-col":e.formItemLayout.labelCol,"wrapper-col":e.formItemLayout.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["operateName"],expression:"[\n                              'operateName',\n                            ]"}],model:{value:e.operationName,callback:function(t){e.operationName=t},expression:"operationName"}})],1)],1)],1),a("a-row",{attrs:{justify:"end",type:"flex"}},[a("a-button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.operateAuthority}},[e._v("提交")])],1)],2),a("a-modal",{attrs:{centered:"",cancelText:"取消",okText:"确认"},on:{ok:e.handleConfirm},model:{value:e.authVisible,callback:function(t){e.authVisible=t},expression:"authVisible"}},[a("span",{staticClass:"common-head-font",attrs:{slot:"title"},slot:"title"},[e._v("父级菜单选择")]),e.authVisible?a("MenuSide",{attrs:{isOper:!1,type:"addPreMenu"},on:{selectedItem:e.selectPreMenu}}):e._e()],1)],1)},f=[],y=(a("7bc1"),a("af3e")),v={components:{AButton:y["a"],MenuSide:d},data:function(){return{operationId:void 0,operationName:void 0,menuId:"",type:"",menuName:"",menuPath:"",formItemLayout:{labelCol:{span:6},wrapperCol:{span:16}},form:this.$form.createForm(this),authVisible:!1,preMenuData:void 0,operatePreMenuData:void 0,modalType:"preMenu",menuLevel:"",businessIdIsDisable:!0,isAuthority:!1}},props:{mainContext:{type:Array,default:function(){return[]}},functions:{type:Object,default:function(){return""}},authValue:{type:Array,default:function(){return[]}}},watch:{mainContext:{handler:function(e){var t=[],a=[],i={},n=e.treeData,s=this.getMenuLink(e[0].key,n,t),r=this.getNextOrg(n,e[0].key,a);this.menuId=e[0].key,"edit"==e.type?(0==s.menuType&&(this.menuPath=s.menuLink,this.menuName=this.subSome(e[0].title),void 0==r?i={title:"权限控制"}:r.title=this.subSome(r.title),this.preMenuData=r||i,this.operatePreMenuData="",this.operationName="",this.operationId="",this.menuLevel=s.menuLevel),1==s.menuType&&(void 0==r?i={title:"权限控制"}:r.title=this.subSome(r.title),this.operatePreMenuData=r||i,this.operationName=this.subSome(e[0].title),this.operationId=s.operationId,this.menuPath="",this.menuName="",this.preMenuData=""),this.type=2):"add"==e.type?(this.type=0,this.menuName="",s.menuType?0==s.menuType?this.preMenuData=e[0]:this.operatePreMenuData=e[0]:this.preMenuData=e[0],this.operationName="",this.menuPath="",this.menuLevel=""):"addAuthNew"==e.type?(this.generateBusinessId(),this.type=0,this.menuName="",this.operatePreMenuData=e[0],this.operationName="",this.menuPath="",this.menuLevel=""):(this.type=1,this.menuName="",this.menuPath="",this.preMenuData="",this.operatePreMenuData="",this.operationName="")}},functions:{handler:function(e){}}},methods:{generateBusinessId:function(){var e=this;Object(o["a"])().then((function(t){var a=t;e.operationId=a}))},operateAuthorityPage:function(){this.authVisible=!0,this.modalType="operatePreMenu",this.isAuthority=!0},subSome:function(e){if(e){var t=e.split("(");return t[0]}},getMenuLink:function(e,t,a){for(var i=0;i<t.length;i++)t[i].key==e&&a.push({menuLink:t[i].menuLink,menuType:t[i].menuType,operationId:t[i].businessId,menuLevel:t[i].menuLevel}),t[i].children&&t[i].children.length>0&&this.getMenuLink(e,t[i].children,a);return a[0]},getNextOrg:function(e,t,a){for(var i=0;i<e.length;i++){var n=e[i];n.key==t?a.push(n.parentId):n.children&&this.getNextOrg(n.children,t,a)}return this.functions.refs.getOrgName(a)[0]},selectPreMenu:function(e){var t=e.title;t.indexOf("(菜单)")&&this.isAuthority&&(console.log(t),this.businessIdIsDisable=!1),"operatePreMenu"===this.modalType?(this.operatePreMenuData=e,this.operatePreMenuData.title=this.operatePreMenuData.title?this.subSome(this.operatePreMenuData.title):""):(this.preMenuData=e,this.preMenuData.title=this.preMenuData.title?this.subSome(this.preMenuData.title):"")},handleConfirm:function(){this.preMenuData||this.operatePreMenuData?this.authVisible=!1:this.$message.error("还没有选中父级菜单")},menuAuthority:function(){var e=this,t=this.preMenuData?this.preMenuData:"";this.type||(this.type=0);var a=this.authValue[1];if(0!=this.type||a){var i={type:this.type,menuName:this.menuName,parentId:t?"权限控制"==t.title?0:this.preMenuData.key:"",menuLink:this.menuPath,menuType:0,menuId:0!==this.type?this.menuId:"",menuLevel:this.menuLevel};this.preMenuData&&this.menuPath?this.preMenuData.key!==this.menuId||0===this.type?Object(o["d"])(i).then((function(t){e.$message.success(t),e.preMenuData="",e.menuName="",e.menuPath="",e.menuLevel="",e.functions.refs.getTree()})):this.$message.error("父级菜单不能和当前菜单重复，请检查！"):this.$message.error("输入框不能为空！")}else this.$message.error("无权限")},operateAuthority:function(){var e=this,t=this.operatePreMenuData?this.operatePreMenuData:"";this.type||(this.type=0);var a=this.authValue[1],i=this.authValue[2];if(0!=this.type||a)if(2!=this.type||i){if(!this.operationId)return void this.$message.error("新增权限操作，操作ID不能为空！");var n={type:this.type,menuName:this.operationName,parentId:t?"权限控制"==t.title?0:t.key:"",businessId:this.operationId,menuType:1,menuId:0!==this.type?this.menuId:""};this.operatePreMenuData&&this.operatePreMenuData.key&&this.operationName&&this.operationId?this.operationName!=this.operatePreMenuData.key?Object(o["d"])(n).then((function(t){e.$message.success(t),e.operationName="",e.operatePreMenuData="",e.operationId="",e.functions.refs.getTree()})):this.$message.error("父级菜单和操作名称重复！"):this.$message.error("输入框不能为空！")}else this.$message.error("无权限");else this.$message.error("无权限")}}},g=v,b=Object(p["a"])(g,m,f,!1,null,null,null),M=b.exports,x={components:{MenuSide:d,MainContext:M},data:function(){return{Value:[],type:"",query:1047,add:1048,edit:1049,delete:1050,isHasQuery:!1,isAdd:!1,isEdit:!1,isDelete:!1,authValue:[this.isHasQuery,this.isAdd,this.isEdit,this.isDelete]}},methods:{mainSide:function(e,t,a){e.type=t,e.treeData=a,this.Value=Object.assign([],e)}},mounted:function(){this.isHasQuery=Object(o["c"])(this.query),this.isAdd=Object(o["c"])(this.add),this.isEdit=Object(o["c"])(this.edit),this.isDelete=Object(o["c"])(this.delete),this.authValue=[this.isHasQuery,this.isAdd,this.isEdit,this.isDelete]}},D=x,k=Object(p["a"])(D,i,n,!1,null,"b2c346c2",null);t["default"]=k.exports}}]);