(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12846778"],{"1b70":function(e,t,a){"use strict";var s=a("53ef"),n=a.n(s);n.a},"53ef":function(e,t,a){},ad2f:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return p}));var s=a("0c6d"),n=(a("08c1"),a("4360")),i=a("e1d2");function r(e){return s["a"].fetchG({url:"/teamwork-api/sec/getSecMenus",data:e})}function l(e){return s["a"].fetchP({url:"/teamwork-api/sec/saveSecMenus",data:e})}function o(e){return s["a"].fetchG({url:"/teamwork-api/sec/generateBusinessId",data:e})}var c=!1,d=function e(t,a){for(var s=0;s<a.length;s++){var n=a[s];n&&(n.businessId&&n.businessId===t?c=!0:a[s].secMenuDOS&&e(t,a[s].secMenuDOS))}};function p(e){var t=n["a"].state.MenuData.menuData;return t&&0===t.length?(t=i["a"].getMenuData2({userId:n["a"].state.userContext.userInfo.staffId}),c=!1,d(e,t),c):(c=!1,d(e,t),c)}},b969:function(e,t,a){"use strict";var s=a("ec76"),n=a.n(s);n.a},beec:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"10px"}},[a("a-row",{attrs:{gutter:20}},[a("a-col",{staticClass:"container",style:{minHeight:"addPreMenu"==e.type?"300px":"550px"},attrs:{span:7}},[a("a-button",{directives:[{name:"show",rawName:"v-show",value:e.isHasAdd,expression:"isHasAdd"}],attrs:{type:"primary",icon:"plus"},on:{click:function(t){return e.createTask()}}},[e._v("创建分类")]),a("a-input-search",{staticStyle:{"margin-bottom":"8px"},attrs:{placeholder:"Search"},on:{change:e.onChange}}),a("a-tree",{attrs:{expandedKeys:e.expandedKeys,autoExpandParent:e.autoExpandParent,treeData:e.treeData},on:{expand:e.onExpand,select:e.onSelect},scopedSlots:e._u([{key:"title",fn:function(t){return[t.title.indexOf(e.searchValue)>-1?a("span",[e._v("\n                "+e._s(t.title.substr(0,t.title.indexOf(e.searchValue)))+"\n                "),a("span",{staticStyle:{color:"#f50"}},[e._v(e._s(e.searchValue))]),e._v("\n                "+e._s(t.title.substr(t.title.indexOf(e.searchValue)+e.searchValue.length))+"\n                "),e.selectedKeys==t.key||e.selectedKeysCopy==t.key?a("span",[e.isEdit?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("编辑分类")])]),a("a-icon",{attrs:{type:"edit"},on:{click:function(t){return t.stopPropagation(),e.editAuth(t)}}})],2):e._e(),e.isHasAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加子分类")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addAuth(t)}}})],2):e._e(),e.isDelete?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("删除")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"minus-circle"},on:{click:function(t){return t.stopPropagation(),e.removeAuth(t)}}})],2):e._e()],1):e._e()]):a("span",[e._v("\n                  "+e._s(t.title)+"\n                  "),e.selectedKeys==t.key||e.selectedKeysCopy==t.key?a("span",[e.isEdit?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("编辑分类")])]),a("a-icon",{attrs:{type:"edit"},on:{click:function(t){return t.stopPropagation(),e.editAuth(t)}}})],2):e._e(),e.isHasAdd?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("添加子分类")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addAuth(t)}}})],2):e._e(),e.isDelete?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("删除")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"minus-circle"},on:{click:function(t){return t.stopPropagation(),e.removeAuth(t)}}})],2):e._e()],1):e._e()])]}}])})],1),a("a-col",{attrs:{span:17}},[a("div",[a("a-card",[a("template",{slot:"title"},[a("span",{staticClass:"common-head-font"},[e._v("分类模版信息")])]),a("a-row",[a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"分类名称","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:21}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["className"],expression:"[\n                                    'className'\n                                  ]"}],attrs:{disabled:!0},model:{value:e.className,callback:function(t){e.className=t},expression:"className"}})],1)],1)],1)],1)],1),a("a-row",[a("a-col",{attrs:{span:12}},[a("a-form-item",{attrs:{label:"模版名称","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-select",{staticStyle:{width:"260px"},attrs:{clearable:"",placeholder:"选择一个模版"},on:{change:e.choseTemplate1},model:{value:e.templateSelect,callback:function(t){e.templateSelect=t},expression:"templateSelect"}},e._l(e.templateInfo,(function(t){return a("a-select-option",{attrs:{value:t.id}},[e._v("\n                    "+e._s(t.name)+"\n                  ")])})),1)],1)],1)],1),a("a-row",{attrs:{justify:"end",type:"flex"}},[a("a-button",{directives:[{name:"show",rawName:"v-show",value:e.isCommit,expression:"isCommit"}],staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.commitTemplateClass}},[e._v("提交")])],1)],2)],1)]),a("a-modal",{attrs:{visible:e.templateVisible,cancelText:"取消",okText:"确认"},on:{cancel:function(t){e.templateVisible=!1},ok:e.handleConfirm}}),a("a-modal",{attrs:{visible:e.organizeVisible,cancelText:"取消",okText:"确认"},on:{cancel:e.handleCancel,ok:e.handleConfirm}},[a("span",{staticClass:"common-head-font",attrs:{slot:"title"},slot:"title"},[e._v("上级组织选择")]),a("a-tree",{attrs:{expandedKeys:e.expandedKeysCopy,autoExpandParent:e.autoExpandParentCopy,treeData:e.treeData},on:{expand:e.onExpandCopy,select:e.onSelect}})],1),a("a-modal",{attrs:{visible:e.classDeal,width:800},on:{cancel:function(t){e.classDeal=!1},ok:function(t){e.classDeal=!1}}},[a("a-card",{staticStyle:{"margin-top":"10px"}},[a("template",{slot:"title"},[2==e.type?a("span",{staticClass:"common-head-font"},[e._v("修改任务")]):0==e.type?a("span",{staticClass:"common-head-font"},[e._v("新增分类")]):3==e.type?a("span",{staticClass:"common-head-font"},[e._v("新增父级分类")]):e._e()]),a("a-row",[a("a-form",{attrs:{form:e.form}},[a("a-col",{attrs:{span:11}},[a("a-form-item",{attrs:{label:"分类名称","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-row",{attrs:{gutter:100}},[a("a-col",{attrs:{span:21}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["className",{rules:[{required:!0,message:"请输入任务分类名称"}]}],expression:"[\n                                    'className',\n                                    {rules: [{ required: true, message: '请输入任务分类名称' }]}\n                                  ]"}]})],1)],1)],1)],1),a("a-col",{attrs:{span:11}},[a("a-form-item",{attrs:{label:"上级分类","label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-row",{attrs:{gutter:10}},[a("a-col",{attrs:{span:21}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["parentClassId",{rules:[{required:!1,message:"请输入上级任务分类"}]}],expression:"[\n                                    'parentClassId',\n                                    {rules: [{ required: false, message: '请输入上级任务分类' }]}\n                                  ]"}],attrs:{disabled:!0}})],1)],1)],1)],1),a("a-col",{directives:[{name:"show",rawName:"v-show",value:e.isShowAdd,expression:"isShowAdd"}],attrs:{span:2}},[a("a-form-item",{attrs:{"label-col":e.formItemLayout.labelCol,"wrapper-col":{span:18}}},[a("a-icon",{staticStyle:{"font-size":"20px",color:"#18c4b0",cursor:"pointer"},attrs:{type:"plus-circle"},on:{click:function(t){return t.stopPropagation(),e.addOrganize(t)}}})],1)],1)],1)],1),a("a-row",{attrs:{justify:"end",type:"flex"}},[a("a-button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.submitOrg}},[e._v("提交")])],1)],2)],1),a("a-modal",{attrs:{title:"再次确认",okText:"确认",cancelText:"取消"},on:{ok:e.hideModal},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("p",[e._v("确认要删除吗？")])])],1)],1)},n=[],i=a("0c6d");function r(e){return i["a"].fetchG({url:"/teamwork-api/project/getTaskClassification",data:e})}function l(e){return i["a"].fetchP({url:"/teamwork-api/project/taskDeal",data:e})}function o(e){return i["a"].fetchG({url:"/teamwork-api/project/updateClassTemplate",data:e})}function c(e){return i["a"].fetchG({url:"/teamwork-api/project/queryTemplateInfoByClassId",data:e})}var d=a("d552"),p=a("5fd0"),u=a("a78e"),m=a("f91d"),h=a("ad2f"),f=[],y=function e(t,a){for(var s,n=0;n<a.length;n++){var i=a[n];i.children&&(i.children.some((function(e){return e.key===t}))?s=i.key:e(t,i.children)&&(s=e(t,i.children)))}return s},g={components:{ARow:u["a"],ACol:p["b"],AModal:d["a"]},name:"taskSort",methods:{commitTemplateClass:function(){var e=this;if(""!==this.className)if(""!==this.choseTemplateId){var t={classId:this.selectedKeys,templateId:this.choseTemplateId};o(t).then((function(t){e.openNotificationWithIcon("success","提示","保存成功")})),this.className="",this.templateSelect=void 0}else this.$message.error("请选择模版！");else this.$message.error("请先选择分类！")},openNotificationWithIcon:function(e,t,a){this.$notification[e]({message:t,description:a})},choseTemplate1:function(e){this.choseTemplateId=e,this.templateSelect=e},showTemplate:function(){this.templateVisible=!0},choseTemplate:function(){this.className=this.getOrgName(this.selectedKeys)},createTask:function(){this.isShowAdd=!1,this.classDeal=!0,this.type=3},hideModal:function(){var e=this;l({type:1,classId:this.selectedKeys}).then((function(t){e.$message.success(t),e.form.setFieldsValue({className:"",parentClassId:""}),e.formCopy.setFieldsValue({parentClassId:""}),e.getData()})),this.visible=!1},removeAuth:function(){this.visible=!0},addAuth:function(){var e=this;this.classDeal=!0,this.addRelatOrgId=this.selectedKeys,this.type=0,this.formCopy.setFieldsValue({countId:"",parentClassId:this.getOrgName(this.selectedKeys)});var t=this.form.setFieldsValue;this.$nextTick((function(){t({className:"",parentClassId:e.getOrgName(e.selectedKeys)})}))},onSelect:function(e){var t=this;this.Count?this.selectedKeysCopy=e[0]:this.selectedKeys=e[0],this.className=this.getOrgName(e[0]),c({id:e}).then((function(e){e.templateName;var a=e.id;t.templateSelect=a||void 0}))},getOrgId:function(e){for(var t,a=0;a<f.length;a++)e==f[a].title&&(t=f[a].key);return t},submitOrg:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var s=e.type&&0!=e.type?e.relatOrgId1:e.addRelatOrgId;3===e.type&&(e.type=0,s=0);var n={className:a.className,parentClassId:s,type:e.type?e.type:0,classId:e.type&&0!=e.type?e.getOrgId(e.oldOrgName):""};l(n).then((function(t){e.$message.success(t),e.form.setFieldsValue({className:"",parentClassId:""}),e.getData(),e.classDeal=!1}))}}))},onExpandCopy:function(e){this.expandedKeysCopy=e,this.autoExpandParentCopy=!1},handleConfirm:function(){this.formCopy.setFieldsValue({parentClassId:this.getOrgName(this.selectedKeysCopy)}),this.form.setFieldsValue({parentClassId:this.getOrgName(this.selectedKeys)}),this.organizeVisible=!1,this.selectedKeys&&(this.deleteLable=!0),this.selectedKeysCopy&&(this.deleteLableCopy=!0)},handleCancel:function(){this.organizeVisible=!1},addOrganize:function(){this.Count=!1,this.organizeVisible=!0},getNextOrg:function(e,t,a){for(var s=0;s<e.length;s++){var n=e[s];n.key==t?a.push(n.parent):n.children&&this.getNextOrg(n.children,t,a)}return this.getOrgName(a[0])},getOrgName:function(e){for(var t,a=0;a<f.length;a++)e==f[a].key&&(t=f[a].title);return t},editAuth:function(e){var t=this;this.type=2;var a=[];this.oldOrgName=this.getOrgName(this.selectedKeys),this.relatOrgId1=y(this.selectedKeys,this.treeData),this.classDeal=!0;var s=this.form.setFieldsValue;this.$nextTick((function(){s({className:t.getOrgName(t.selectedKeys),parentClassId:t.getNextOrg(t.treeData,t.selectedKeys,a)})}))},getArray:function(e,t){for(var a=0;a<e.length;a++)t.push({className:e[a].className,classId:e[a].classId}),e[a].child&&e[a].child.result&&this.getArray(e[a].child.result,t);return t},searchMenu:function(e){for(var t=0;t<e.length;t++)e[t].title=e[t].className,e[t].key=e[t].classId,e[t].scopedSlots={title:"title"},e[t].parent=e.parentId,e[t].child&&e[t].child.result&&(e[t].children=e[t].child.result,e[t].children.parentId=e[t].classId,this.searchMenu(e[t].child.result))},onChange:function(e){var t=this,a=e.target.value,s=f.map((function(e){return e.title.indexOf(a)>-1?y(e.key,t.treeData):null})).filter((function(e,t,a){return e&&a.indexOf(e)===t}));Object.assign(this,{expandedKeys:s,searchValue:a,autoExpandParent:!0})},getData:function(){var e=this;r({}).then((function(t){t=t.result,e.treeData=t,e.searchMenu(t);var a=function e(t){for(var a=0;a<t.length;a++){var s=t[a],n=s.key;f.push({key:n,title:s.title}),s.children&&e(s.children,s.key)}};a(t)})),this.templateInfo=[],Object(m["c"])({state:1}).then((function(t){console.log(t);for(var a=0;a<t.length;a++)e.templateInfo.push({id:t[a].id,name:t[a].templateName})}))},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1}},mounted:function(){this.isHasQuery=Object(h["c"])(this.query),this.isHasQuery&&this.getData(),this.isHasAdd=Object(h["c"])(this.add),this.isEdit=Object(h["c"])(this.edit),this.isDelete=Object(h["c"])(this.delete),this.isCommit=Object(h["c"])(this.commit)},data:function(){return{query:1106,add:1107,edit:1108,delete:1109,commit:1110,isHasQuery:!1,isHasAdd:!1,isEdit:!1,isDelete:!1,isCommit:!1,templateSelect:void 0,className1:"",choseTemplateId:"",templateInfo:[],templateVisible:!1,className:"",templateName:"",isShowAdd:!0,relatOrgId1:"",addRelatOrgId:"",oldOrgName:"",treeDatas:[],deleteLableCopy:!1,deleteLable:!1,autoExpandParentCopy:!0,expandedKeysCopy:[],formItemLayout:{labelCol:{span:6},wrapperCol:{span:16}},type:"",organizeVisible:!1,classDeal:!1,Count:"",form:this.$form.createForm(this),formCopy:this.$form.createForm(this),selectedKeys:[],selectedKeysCopy:[],searchValue:"",expandedKeys:[],autoExpandParent:!0,treeData:[],createType:"",visible:!1}}},v=g,b=(a("b969"),a("1b70"),a("4e82")),x=Object(b["a"])(v,s,n,!1,null,"84c54536",null);t["default"]=x.exports},ec76:function(e,t,a){},f91d:function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i})),a.d(t,"e",(function(){return r})),a.d(t,"b",(function(){return l})),a.d(t,"d",(function(){return o}));var s=a("0c6d");function n(e){return s["a"].fetchG({url:"/teamwork-api/project/queryTemplate",data:e})}function i(e){return s["a"].fetchP({url:"/teamwork-api/project/createTemplate",data:e})}function r(e){return s["a"].fetchP({url:"/teamwork-api/project/updateTemplate",data:e})}function l(e){return s["a"].fetchG({url:"/teamwork-api/project/deleteTemplate",data:e})}function o(e){return s["a"].fetchG({url:"/teamwork-api/project/queryTemplateById",data:e})}}}]);